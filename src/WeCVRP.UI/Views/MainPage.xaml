<?xml version="1.0" encoding="utf-8" ?>
<ContentPage xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             xmlns:viewmodel="clr-namespace:WeCVRP.UI.ViewModels"
             xmlns:converters="clr-namespace:WeCVRP.UI.Converters"
             xmlns:maps="clr-namespace:Mapsui.UI.Maui;assembly=Mapsui.UI.Maui"
             x:Class="WeCVRP.UI.Views.MainPage">
    <ContentPage.Resources>
        <ResourceDictionary>
            <converters:AlgorithmNameConverter x:Key="AlgorithmNameConverter" />
            <converters:SearchButtonConverter x:Key="SearchButtonConverter" />
        </ResourceDictionary>
    </ContentPage.Resources>
    
    <ContentPage.BindingContext>
        <viewmodel:MainPageViewModel x:Name="mainPageViewModel" />
    </ContentPage.BindingContext>

    <!-- MenuBar -->
    <ContentPage.MenuBarItems>
        <!-- File entry -->
        <MenuBarItem Text="File">
            <MenuFlyoutItem Text="Open" Command="{Binding OpenFileCommand}" />
            <MenuFlyoutItem Text="Save" Command="{Binding SaveFileCommand}" />
            <MenuFlyoutItem Text="Save As" Command="{Binding SaveAsFileCommand}" />
            <MenuFlyoutSeparator />
            <MenuFlyoutItem Text="About" Command="{Binding OpenAboutCommand}"/>
            <MenuFlyoutSeparator />
            <MenuFlyoutItem Text="Exit" Command="{Binding ExitCommand}"/>
        </MenuBarItem>
        
        <!-- Settings entry -->
        <MenuBarItem Text="Settings">
            <!-- Algorithm entry -->
            <MenuFlyoutSubItem Text="Algorithm">
                <MenuFlyoutItem Text="Clarke-Wright" Command="{Binding AlgorithmClickedCommand}" CommandParameter="ClarkeWright" />
            </MenuFlyoutSubItem>

            <!-- Direction entry -->
            <MenuFlyoutSubItem Text="Direction">
                <MenuFlyoutItem Text="Relative" Command="{Binding DirectionClickedCommand}" CommandParameter="Relative" />
                <MenuFlyoutItem Text="Direct" Command="{Binding DirectionClickedCommand}" CommandParameter="Direct" />
            </MenuFlyoutSubItem>
        </MenuBarItem>
    </ContentPage.MenuBarItems>

    <!-- Frame -->
    <Grid ColumnSpacing="5" ColumnDefinitions="*,4*" Padding="10">
        <!-- Settings & Calculate button -->
        <Grid Grid.Column="0" RowSpacing="5" RowDefinitions="30, 30, 30, 30, *">
            <!-- Settings label -->
            <Label Grid.Row="0" Text="Options" FontSize="Medium" HorizontalOptions="Center" HorizontalTextAlignment="Center" />

            <!-- Algorithm option -->
            <HorizontalStackLayout Grid.Row="1" Spacing="5">
                <Label Text="Algorithm:" />
                <Label Text="{Binding Algorithm, Converter={StaticResource AlgorithmNameConverter}}" />
            </HorizontalStackLayout>

            <!-- Direction option -->
            <HorizontalStackLayout Grid.Row="2" Spacing="5">
                <Label Text="Direction:" />
                <Label Text="{Binding Direction}" />
            </HorizontalStackLayout>

            <!-- Points option -->
            <HorizontalStackLayout Grid.Row="3" Spacing="5">
                <Label Text="Points:" />
                <Label Text="{Binding PointsCount}" />
            </HorizontalStackLayout>

            <!-- Calculate button -->
            <Button Grid.Row="4" Text="Calculate" VerticalOptions="End" />
        </Grid>

        <!-- Search & Map -->
        <Grid Grid.Column="1" RowSpacing="5" RowDefinitions="35,*">
            <!-- Search -->
            <Grid Grid.Row="0" ColumnSpacing="5" ColumnDefinitions="8*,*">
                <Entry Grid.Column="0" Placeholder="Type place here" Text="{Binding PlaceName}" ReturnCommand="{Binding SearchCommand}" HorizontalTextAlignment="Center" TextChanged="OnSearchTextChanged" />
                <Button Grid.Column="1" Text="{Binding HasFoundLocations, Converter={StaticResource SearchButtonConverter}}" Command="{Binding SearchCommand}" />
            </Grid>

            <!-- Map -->
            <maps:MapView Grid.Row="1" IsZoomButtonVisible="False" IsMyLocationButtonVisible="False" IsNorthingButtonVisible="False" Map="{Binding Map}" />
        </Grid>
    </Grid>
</ContentPage>
